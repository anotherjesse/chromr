<html>
<head> 
<title>Interestingness</title> 
<script>

var current_idx;

function show(photo) {
  var h = 'http://farm'+photo.farm+'.static.flickr.com/'+photo.server+'/'+photo.id+'_'+photo.secret+'_b.jpg';
	document.getElementById('content').innerHTML = "<img src='"+h+"'/>";
	var info = document.getElementById('info');
	info.innerText = (photo.title._content || 'untitled') + ' by ' + (photo.owner.realname || photo.owner.username);
	info.setAttribute('href', photo.urls.url[0]._content)
}

function load(photo) {
  svc.flickr({
    method: 'flickr.photos.getInfo',
    photo_id: photo.id
  }, function(json) {
    show(json.photo);
  })
}

function chooseRandom() {
  var photos = chrome.extension.getBackgroundPage().photos;
  current_idx = Math.floor(Math.random()*photos.length);
  load(photos[current_idx]);
}

function addListeners() {
  document.addEventListener('keypress', function(e) {
    if (e.keyCode==106) {
      current_idx = (current_idx + 1) % photos.length;
      load(photos[current_idx]);
    }
    if (e.keyCode==107) {
      current_idx = (current_idx - 1 + photos.length) % photos.length;
      load(photos[current_idx]);
    }
  }, true);
};

window.onload = function() {
  svc = chrome.extension.getBackgroundPage();
  addListeners();
  chooseRandom();
  // console.log(svc.isSetup());
};

 
</script> 
<style>

* {
    margin: 0;
    padding: 0;
}

html, body {
    overflow:hidden;
    background: #000;    
}

table {  
  height: 100%;  
  width: 100%;
}

img {
  max-height: 90%;
  max-width: 90%;
}

#info {
  background: rgba(0,0,0,0.5);
  bottom: 50px;
  color: #fff;
  width: 100%;
  font-size: 24px;
  padding: 1em;
  position: fixed;
  text-decoration: none;
}
</style> 
</head> 
<body>
  <table>
    <tr><td id="content"></td></tr>
  </table>
  <a id="info"></a>
</body> 
</html>